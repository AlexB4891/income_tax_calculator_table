<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alex Bajaña">
<meta name="author" content="Carla Chamorro">
<meta name="dcterms.date" content="2022-11-01">

<title>Income tax calculator table for labor contracts in Ecuador</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>


<script src="prueba_files/libs/clipboard/clipboard.min.js"></script>
<script src="prueba_files/libs/quarto-html/quarto.js"></script>
<script src="prueba_files/libs/quarto-html/popper.min.js"></script>
<script src="prueba_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="prueba_files/libs/quarto-html/anchor.min.js"></script>
<link href="prueba_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="prueba_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="prueba_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="prueba_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="prueba_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">


<link rel="stylesheet" href="css/new_css.css">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page">
      <h1 class="title">Income tax calculator table for labor contracts in Ecuador</h1>
            <p class="subtitle lead">Preparate para el nuevo mecanismo de pago del impuesto a renta en Ecuador con esta sencilla aplicación</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Alex Bajaña </p>
               <p>Carla Chamorro </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 1, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content quarto-banner-title-block column-page" id="quarto-document-content">




<div class="cell" data-context="setup">

</div>
<section id="primeros-pasos" class="level2">
<h2 class="anchored" data-anchor-id="primeros-pasos">Primeros pasos</h2>
<div class="row">

<div class="column">
<section id="el-impuesto-a-la-renta-en-ecuador" class="level3">
<h3 class="anchored" data-anchor-id="el-impuesto-a-la-renta-en-ecuador">El impuesto a la renta en Ecuador</h3>
<hr>
<p>El impuesto a la renta<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> se aplica sobre aquellas rentas que obtengan las personas naturales, las sucesiones indivisas y las sociedades sean nacionales o extranjeras. El ejercicio impositivo comprende del 1 de enero al 31 de diciembre (Asamblea Nacional del Ecuador, 2004; Presidencia de la República del Ecuador, 2010).</p>
<p>En cuanto a las personas naturales, aquellas que tengan una relación bajo dependencia o no, que estén o no obligadas<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> a llevar contabilidad , tienen la obligatoriedad de realizar su declaración de impuesto a la renta anual.</p>
</section>

</div>
<div class="column">
<section id="relación-de-dependencia" class="level3">
<h3 class="anchored" data-anchor-id="relación-de-dependencia">Relación de dependencia</h3>
<hr>
<p>El Código del Trabajo en su artículo 8 define al contrato individual como: “(…) convenio en virtud del cual una persona se compromete para con otra u otras a prestar sus servicios lícitos y personales, bajo su dependencia, por una remuneración fijada por el convenio, la ley, el contrato colectivo o la costumbre” (Congreso Nacional, 2005).</p>
<p>Con base en este artículo, la condición de relación bajo dependencia alude a que el trabajador mantiene una relación de subordinación frente a su patrono y de obediencia a las disposiciones para el desarrollo de las actividades laborales.</p>
</section>
</div>
<p><br></p>
<hr>
<p><strong>El ejemplo está desarrollado para una persona que al mes tiene como ingresos 3 salario básico unificado (SBU 2022), es decir 1416 USD, si quieres generar tu propio cálculo da click en el botón</strong></p>
<div class="cell">
<div class="cell-output-display">
<button id="datos" style="width:100%;" type="button" class="btn btn-default action-button">Ingresa tus datos</button>
</div>
</div>
<p><br></p>
<div class="cell" data-context="server">

</div>
</div></section>
<section id="los-insumos-para-el-cálculo-del-impuesto-a-la-renta" class="level2">
<h2 class="anchored" data-anchor-id="los-insumos-para-el-cálculo-del-impuesto-a-la-renta">Los insumos para el cálculo del impuesto a la renta</h2>
<p>En esta tabla encuentra un resumen de tus ingresos, gastos personales y con ellos en la sección <strong>resumen impositivo</strong>, observa cuales son los parametros para el cálculo del impuesto a la renta.</p>
<div class="cell" data-context="server">

</div>
<div class="cell">
<div class="cell-output-display">
<div id="tabla_argumentos" class="shiny-html-output"></div>
</div>
</div>
<p>Con los insumos presentados, vamos a calcular el impuesto a la renta:</p>
<div class="cell">
<div class="cell-output-display">
<div id="tabla_resultado" class="shiny-html-output"></div>
</div>
</div>
<p>Obligaciones fiscales:</p>
<div class="cell">
<div class="cell-output-display">
<div id="mensaje" class="shiny-html-output"></div>
</div>
</div>
<p><br></p>
<p><strong>Si tienes dudas, puedes consultar el glosario fiscal</strong></p>
<div class="cell">
<div class="cell-output-display">
<div class="btn-group btn-group-normal btn-group-justified" role="group">
<div class="btn-group btn-group-normal" role="group">
<button id="glo_gas" type="button" class="btn action-button btn-primary">Glosario de gastos</button>
</div>
<div class="btn-group btn-group-normal" role="group">
<button id="glo_ing" type="button" class="btn action-button btn-primary">Glosario de ingresos</button>
</div>
<div class="btn-group btn-group-normal" role="group">
<button id="glo_bas" type="button" class="btn action-button btn-primary">Glosario base imponible</button>
</div>
</div>
</div>
</div>
<p>
<script type="application/shiny-prerendered" data-context="server-start">

#| include: false 

library(shiny)
library(tidyverse)
library(gt)
library(shinyBS)
library(tippy)
library(scales)
library(ggrepel)
library(readxl)
library(gtExtras)
library(sparkline)
library(plotly)
library(shinyWidgets)
library(pins)

franjas <- read_excel("data/franjas.xlsx")

basic_theme <- function(data, ...){
  data %>% 
    tab_options(
      table.background.color = "#03071e",
      ...
    )
}

carpeta <- board_register_github(repo = "AlexB4891/taller_codam_2022",
                                 branch = "main",
                                 token = "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")


</script>
 
<script type="application/shiny-prerendered" data-context="server">
observeEvent(input$glo_gas,{
             showModal(
               modalDialog(
                          includeHTML("glosario_gastos.html"),
                 footer = actionButton(inputId = "close_glo_gas","Cerrar"),
                 size = "l", style = "overflow-wrap: break-word;"
               )
             )
  })

observeEvent(input$glo_ing,{
             showModal(
               modalDialog(
                          includeHTML("glosario_ingresos.html"),
                 footer = actionButton(inputId = "close_glo_ing","Cerrar"),
                 size = "l", style = "overflow-wrap: break-word;"
               )
             )
  })

observeEvent(input$glo_bas,{
             showModal(
               modalDialog(
                          includeHTML("glosario_bases.html"),
                 footer = actionButton(inputId = "close_glo_bas","Cerrar"),
                 size = "l", style = "overflow-wrap: break-word;"
               )
             )
  })


observeEvent(input$close_glo_gas,{
  removeModal()
})

observeEvent(input$close_glo_ing,{
  removeModal()
})

observeEvent(input$close_glo_bas,{
  removeModal()
})

observeEvent(input$datos,
             showModal(
               modalDialog(
                 h2("Cueentanos un poco sobre ti:"),
                 fluidRow(
                   column(6,
                          textInput(inputId = "nombre", 
                                    label =  "¿Cómo te llamas?",
                                    value = "Don Telesforo")
                   ),
                   column(6,
                          selectInput(inputId = "genero", 
                                      label =  "¿Con que género te identificas?",
                                      choices = c("Masculino","Femenino","Otro"),
                                      selected = "Masculino"))
                 ),
                   with_tippy(
                     numericInput(inputId = "ingreso_lab", 
                                  label =  "¿Cual es tu salario mensual?",
                                  min = 1,
                                  max = 999999,
                                  value = 472),
                     tooltip = "Considera unicamente los ingresos bajo relación de dependencia", 
                     placement = "right"
                   ),
                    
                          with_tippy(
                          sliderInput(inputId = "meses",
                                      label = "Número de meses trabajados:",
                                      min = 1,
                                      max = 12,
                                      value = 12),
                     tooltip = "Número de meses que trabajas con un mismo empleador", 
                     placement = "right"),
                   h2("Declaración de gastos personales"),
                 with_tippy(
                   numericInput(inputId = "gasto_vivienda", 
                                label =  "Vivienda",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Arriendo 
                                  <li>Intereses préstamo hipotecario 
                                  <li>Servicios básicos
                                  <li>Impuesto predial 
                                  <li>Pensiones alimenticias
                                  <li>Otros gastos destinados a la adquisición, construcción, remodelación, ampliación, mejora y mantenimiento de un único bien inmueble. 
                                  <\u002ful> 
                                  En todos los casos señalados en este rubro y en los anteriores, los gastos serán considerados en razón de una sola vivienda."), 
                     placement = "right"),
                 with_tippy(
                   numericInput(inputId = "gasto_educa", 
                                label =  "Educación, arte y cultura",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Matrícula y pensión 
                                  <li>Útiles y textos escolares 
                                  <li>Educación para personas con discapacidad
                                  <li>Cuidado y/o desarrollo infantil 
                                  <li>Uniformes
                                  <li>Artes vivas y escénicas, literarias y narrativas, cinematográficas y audiovisuales, musicales y sonoras
                                  <li>Promoción y difusión de la memoria social y el patrimonio
                                  <li>Artesanías
                                  <li>Pensiones alimenticias
                                  <\u002ful>"), 
                     placement = "right"),
                   
                  with_tippy(
                   numericInput(inputId = "gasto_salud", 
                                label =  "Salud",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Honorarios profesionales de salud
                                  <li>Servicios de salud
                                  <li>Medicamentos, insumos médicos, lentes, órtesis, prótesis y otros accesorios para la salud
                                  <li>Medicina prepagada y prima de seguro médico
                                  <li>Deducible no reembolsado de la liquidación del seguro privado
                                  <li>Pensiones alimenticias
                                  <li>Otros gastos: Relacionados para el bienestar físico y mental, así como aquellos destinados a la prevención, recuperación y rehabilitación de la salud
                                  <\u002ful>"), 
                     placement = "right"),
                 with_tippy(
                   numericInput(inputId = "gasto_alimen", 
                                label =  "Alimentación",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Compras de alimentos para consumo humano y otros productos naturales o artificiales que el ser humano ingiere para subsistir o para su nutrición
                                  <li>Pensiones alimenticias, debidamente sustentadas en acta de mediación o resolución judicial
                                  <li>Compra de alimentos en centros de expendio de alimentos preparados.
                                  <\u002ful>"), 
                     placement = "right"),
                 with_tippy(
                   numericInput(inputId = "gasto_vestimenta", 
                                label =  "Vestimenta",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Se considerarán gastos de vestimenta los realizados por cualquier tipo de prenda de vestir
                                  <li>Pensiones alimenticias, debidamente sustentadas en acta de mediación o resolución judicial
                                  <\u002ful>"), 
                     placement = "right"),
                 with_tippy(
                   numericInput(inputId = "gasto_turismo", 
                                label =  "Turismo",
                                min = 1,
                                max = 999999,
                                value = 472),
                   tooltip = HTML("<ul>
                                  <li>Alojamiento
                                  <li>Transporte
                                  <li>Servicios de alimentos y bebidas
                                  <li>Operación turística
                                  <li>Intermediación turísticas
                                  <li>Parques de atracciones
                                  <li>Pensiones alimentacias
                                  <\u002ful>"), 
                     placement = "right"),
                 
                 footer = tagList(
                   actionButton(inputId = "procesar",
                                label = "Continuar",width = "100%") ,
                   size = "l"
                 ), style = "overflow-x: auto;"
               )
             )
)



</script>
 
<script type="application/shiny-prerendered" data-context="server">
observeEvent(input$procesar,{
  
  removeModal()
  
  pin_get(board = carpeta,
          name = "tabla_impuesto_renta") %>% 
    bind_rows(
     
      tibble(vivienda = input$gasto_vivienda,
         educacion = input$gasto_educa,
         salud = input$gasto_salud,
         alimentacion = input$gasto_alimen,
         vestimenta = input$gasto_vestimenta,
         turismo =  input$gasto_turismo,
         sexo = input$genero,
         nombre = input$nombre)  
    ) %>% 
    pin(x = .,
        name = "tabla_impuesto_renta",
        board = carpeta,
        description = "Ejecucion",
        versiones = T)
  
  
  
})


tabla_presentar <- reactiveValues(
  presentar = tibble(
    ingresos = c(425*3*12,NA_real_,NA_real_,NA_real_,NA_real_,NA_real_),
    gastos_clase = c("Vivienda",
                     "Educación, arte y cultura",
                     "Salud",
                     "Alimentación",
                     "Vestimenta",
                     "Turismo"),
     gastos_valor = c( 3000, # input$gasto_vivienda,
                       2160, # input$gasto_educa,
                       1800, # input$gasto_salud,
                       2640, # input$gasto_alimen,
                       1200, # input$gasto_vestimenta,
                       800   # input$gasto_turismo
       )
    
  )
)

observeEvent(input$procesar,{
  
  tabla_presentar$presentar <- tibble(
    ingresos = c(input$ingreso_lab*input$meses,NA_real_,NA_real_,NA_real_,NA_real_,NA_real_),
    gastos_clase = c("Vivienda",
                     "Educación, arte y cultura",
                     "Salud",
                     "Alimentación",
                     "Vestimenta",
                     "Turismo"),
    gastos_valor = c(input$gasto_vivienda,
                     input$gasto_educa,
                     input$gasto_salud,
                     input$gasto_alimen,
                     input$gasto_vestimenta,
                     input$gasto_turismo)
  )
  
})

tabla_ingresos <- reactive({
  
  tabla_presentar$presentar  %>% 
    mutate(fraccion = percent(gastos_valor/sum(ingresos,na.rm = T)),
           total = sum(ingresos,na.rm = T),
           saldo = total - sum(gastos_valor,na.rm = T),
           otros = sum(gastos_valor,na.rm = T) - gastos_valor,
           gasto_copia = gastos_valor)
  
})


tabla_resumen_impositivo <- reactive({
  
  income <- tabla_ingresos() %>% 
    pull(ingresos) %>% 
    reduce(sum,na.rm = T)
  
  franjas %>% 
  mutate(comparacion = income,
         across(.cols = c(fraccion_basica,exceso_hasta,impuesto_fraccion ),as.numeric),
         regla = comparacion > fraccion_basica & comparacion < exceso_hasta,
         cuota = if_else(income > 24090.3,0.1,0.2)) %>% 
  filter(regla) %>% 
  select(fraccion_basica,
         impuesto_fraccion,
         impuesto_excedente,
         cuota)
})

resumen_impositivo_long <- reactive({
  
  tabla_resumen_impositivo() %>% 
    mutate(across(c(fraccion_basica,
                    impuesto_fraccion),
                  scales::dollar),
           across(c(impuesto_excedente,
                    cuota),
                  scales::percent)) %>% 
    pivot_longer(cols = everything()) %>% 
    mutate(name = case_when(
      name == "fraccion_basica" ~ "Fracción básica (c)",
      name == "impuesto_fraccion" ~ "Impuesto sobre la fracción básica (d)",
      name == "impuesto_excedente" ~ "Tasa sobre el excedente (e)",
      name == "cuota" ~ "Cuota deducible (f)"
    )) %>% 
    bind_rows(tibble(name = c(NA_character_,NA_character_),
                     value = c(NA_character_,NA_character_)))
  
})


calculo_impuesto <- reactive({
  
tabla_ingresos() %>% 
    summarise(across(c(ingresos, gastos_valor),sum,na.rm = T)) %>% 
    cbind(tabla_resumen_impositivo()) %>% 
    transmute(preliminar_1 = ingresos-fraccion_basica,
              preliminar_2 = cuota*gastos_valor,
              preliminar_3 = preliminar_1*impuesto_excedente,
              total = impuesto_fraccion + preliminar_3 - preliminar_2,
              total = if_else(total < 0,0,total),
              tie = total/ingresos) 

})

output$tabla_argumentos <- render_gt({
  
  
  bind_cols(tabla_ingresos(), 
            resumen_impositivo_long()) %>% 
    gt() %>% 
    tab_options(table.background.color = "#051052") %>%  
    cols_hide(columns = c(total,saldo,otros,gasto_copia)) %>%
    cols_align(columns = everything(),align = "center") %>% 
    cols_label(
      ingresos = md("**Ingresos (a)**"),
      gastos_clase = "",
      gastos_valor = md("**Valor**"),
      name = md("**Concepto**"),
      value = md("**Valor**")) %>%
    sub_missing(
      columns = c(ingresos,
                  name,
                  value),
      missing_text = ""
    ) %>% 
    tab_spanner(label =  md("**Gastos personales (b)**"),
                columns = c(gastos_clase,
                            gastos_valor)) %>%
    tab_spanner(label =  md("**Resumen impositivo**"),
                columns = c(name,
                            value))  %>%
    fmt_currency(
      columns = c(gastos_valor,ingresos),
      currency = "USD"
    )  %>%
    # fmt_percent(
    #   columns = fraccion,
    #   incl_space = "\n"
    # )  %>%
    cols_merge_n_pct(col_n =  gastos_valor,
                     col_pct = fraccion, 
                     autohide = TRUE) %>% 
    
    grand_summary_rows(
      columns = c(ingresos, gastos_valor),
      fns = list(
        Total = ~sum(.,na.rm = T)),
      formatter = fmt_currency,
      currency = "USD",
      use_seps = FALSE
    ) %>%
    gt_add_divider(columns = "ingresos", 
                   style = "solid") %>%
    gt_add_divider(columns = "gastos_valor", 
                   style = "solid") %>%
    cols_width(ingresos ~ px(200)) %>%
   tab_style(
     style = list(
       cell_borders(
         sides = c("top", "bottom"),
         color = "#051052",
         weight = px(2)
       ),
       cell_borders(
         sides = c("top", "bottom"),
         color = "#051052",
         weight = px(2)
       ),
       cell_borders(
         sides = c("top", "bottom"),
         color = "#051052",
         weight = px(2)
       ),
       cell_borders(
         sides = "bottom",
         color = "#03071e",
         weight = px(2)
       )
     ),
     locations = list(
       cells_body(
         columns = c(ingresos),
         rows = is.na(ingresos)
       ),
       cells_body(
         columns = name,
         rows = is.na(name)
       ),
       cells_body(
         columns = value,
         rows = is.na(value)
       ),
       cells_stub(rows = everything())
     )
  )  %>% 
    basic_theme(
      column_labels.background.color = "#3b499c",
      row.striping.background_color = "#051052"
    ) %>% 
    opt_row_striping() 
  
})



output$tabla_resultado <- render_gt({

  calculo_impuesto() %>%
    gt() %>%
    tab_options(table.background.color = "#051052") %>%
    cols_label(
      preliminar_1 = md('<p align="right">Ingresos (a)<br> - Fracción Básica (c) <hr style=" background-color: #5399EE; height:2pt; margin-bottom:-1px; margin-top:-1px;" /> <b>Ingresos gravados (g)<\u002fb><\u002fp>'),
      preliminar_2 = md('<p align="right">Total gastos (b)<br> x Cuota deducible (f) <hr style=" background-color: #5399EE; height:2pt; margin-bottom:-1px; margin-top:-1px;" /> <b>Deducción gastos p. (h)<\u002fb><\u002fp>'),
      preliminar_3 = md('<p align="right">Ingresos gravados (g)<br> x Tasa excedente (e) <hr style=" background-color: #5399EE; height:2pt; margin-bottom:-1px; margin-top:-1px;" /> <b>Impuesto preliminar (i)<\u002fb><\u002fp>'),
      total = md('<p align="right">Impuesto preliminar (i)<br> + Impuesto sobre fracción (d)<br> - Deducción gastos (h) <hr style=" background-color: #5399EE; height:2pt; margin-bottom:-1px; margin-top:-1px;" /><b> Impuesto a la renta<\u002fb><\u002fp>'),
      tie = md("**¿Cuanto representa el IR en mis ingresos?**")) %>%
    fmt_currency(
      columns = c(preliminar_1,
                  preliminar_2,
                  preliminar_3,
                  total),
      currency = "USD"
    )  %>%
    fmt_percent(
      columns = tie
    )  %>%
    cols_width(tie ~ px(150))  %>% 
    basic_theme(
      column_labels.background.color = "#3b499c",
      row.striping.background_color = "#051052"
    ) %>% 
    opt_row_striping()  


})

output$mensaje <- renderUI({
  
   impuesto <- calculo_impuesto() %>% 
    pull(total)
   
   if(impuesto == 0){
     
     HTML("
         <b>!En horabuena, no debes pagar impuesto a la renta¡<\u002fb>
         <br>
         Recuerda que debes presentar:
         <ol>
         <li> El <b>Anexo de gastos personales<\u002fb> en febrero de 2023
         <li> El <b>Formulario de impuesto a la renta <\u002fb> en marzo de 2023
         <\u002fol>
         Verifica el último dígito de tu cédula para verificar la fecha de declaración.
          ")
     
   }else{
     HTML(str_c("
         <b>El total de impuesto a la renta<\u002fb> que debes pagar es de ", impuesto,"$ USD"), 
         "
         <br>
         Recuerda que debes presentar:
         <ol>
         <li> El <b>Anexo de gastos personales<\u002fb> en febrero de 2023
         <li> El <b>Formulario de impuesto a la renta <\u002fb> en marzo de 2023
         <\u002fol>
         Verifica el último dígito de tu cédula para verificar la fecha de declaración.
         <br>
          ")
   }
  
})



# output$plot_foot <- renderPlotly({
#   
#   set.seed(1984)
# 
# vec_gastos <- rnorm(6,100,3)
#                   
# conceptos <- tibble( concepto = c( str_c("gasto",1:6),"ingreso no gravado"),
#                      rubro = c(vec_gastos,800 - sum(vec_gastos))
# )
# 
# gastos <- sum(conceptos[1:6,2])*12
# 
# ingresos <- (conceptos[7,2] + sum(vec_gastos))*12
# 
# irenta <- 775.55
# 
# segunda_layer <- tibble( concepto = c("gastos deducibles",
#                                       "impuesto renta",
#                                       "ingreso no gravado"),
#                          rubro = c(gastos*0.1,irenta,ingresos - gastos*0.1-irenta)
# ) %>% unnest()
# 
# 
# conceptos <- conceptos %>% mutate(rubro = rubro*12,
#                                   cs = cumsum(rubro))
# 
# segunda_layer <- segunda_layer %>% mutate(cs = cumsum(rubro))
# 
# 
# plot <-
#   ggplot() +
#   geom_col(data = conceptos,
#            mapping = aes(y = "a",
#                          x = rubro,
#                          fill = concepto),
#            position = "stack",width = 0.5) +
#   geom_label_repel(data = conceptos,
#              mapping = aes(x = cs,
#                            y = "a",
#                            label = concepto,
#                            color = concepto),
#              nudge_y = -0.6) +
#   geom_label_repel(data = segunda_layer,
#              mapping = aes(x = cs,
#                            y = "b",
#                            label = concepto,
#                            color = concepto),
#              nudge_y = 0.6) +
#   geom_col(data = segunda_layer,
#            mapping = aes(y = "b",
#                          x = rubro,
#                          fill = concepto),
#            position = "stack",width = 0.5) +
#   scale_x_continuous(labels = dollar) +
#   # scale_y_continuous() +
#   theme_void() +
#   theme(legend.position = "none",
#         axis.text.x = element_text(),
#         plot.margin = margin( 0,1, 1, 1, "cm"))
# 
#   
# 
# ggplotly(plot)
# 
# })

</script>
 
<script type="application/shiny-prerendered" data-context="server-extras">
ojs_define <- function(..., .session = shiny::getDefaultReactiveDomain()) {
  quos <- rlang::enquos(...)
  vars <- rlang::list2(...)
  nm <- names(vars)
  if (is.null(nm)) {
    nm <- rep_len("", length(vars))
  }
  mapply(function(q, nm, val) {
    # Infer name, if possible
    if (nm == "") {
      tryCatch({
        nm <- rlang::as_name(q)
      }, error = function(e) {
        code <- paste(collapse = "\n", deparse(rlang::f_rhs(q)))
        stop("ojs_define() could not create a name for the argument: ", code)
      })
    }
    .session$output[[nm]] <- val
    outputOptions(.session$output, nm, suspendWhenHidden = FALSE)
    .session$sendCustomMessage("ojs-export", list(name = nm))
    NULL
  }, quos, nm, vars, SIMPLIFY = FALSE, USE.NAMES = FALSE)
  invisible()
}
</script>
</p>
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[]}
</script>
<!--/html_preserve-->
<!--html_preserve-->

<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","broom","bslib","cachem","cellranger","cli","colorspace","compiler","crayon","curl","data.table","datasets","DBI","dbplyr","digest","dplyr","ellipsis","evaluate","fansi","fastmap","fontawesome","forcats","fs","gargle","generics","ggplot2","ggrepel","glue","googledrive","googlesheets4","graphics","grDevices","grid","gt","gtable","gtExtras","haven","hms","htmltools","htmlwidgets","httpuv","httr","jquerylib","jsonlite","knitr","later","lazyeval","lifecycle","lubridate","magrittr","methods","mime","modelr","munsell","paletteer","pillar","pins","pkgconfig","plotly","promises","purrr","R6","rappdirs","Rcpp","readr","readxl","rematch2","reprex","rlang","rmarkdown","rstudioapi","rvest","sass","scales","shiny","shinyBS","shinyWidgets","sparkline","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","tippy","tools","tzdb","utf8","utils","vctrs","viridisLite","withr","xfun","xml2","xtable","yaml"]},{"type":"character","attributes":{},"value":["0.2.1","1.4.1","4.2.0","1.0.1","0.4.1","1.0.6","1.1.0","3.4.1","2.0-3","4.2.0","1.5.2","4.3.3","1.14.4","4.2.0","1.1.3","2.2.1","0.6.30","1.0.10","0.3.2","0.18","1.0.3","1.1.0","0.4.0","0.5.2","1.5.2","1.2.1","0.1.3","3.4.0","0.9.2","1.6.2","2.0.0","1.0.1","4.2.0","4.2.0","4.2.0","0.7.0","0.3.1","0.4.3","2.5.1","1.1.2","0.5.3","1.5.4","1.6.6","1.4.4","0.1.4","1.8.3","1.40","1.3.0","0.2.2","1.0.3","1.8.0","2.0.3","4.2.0","0.12","0.1.9","0.5.0","1.5.0","1.8.1","1.0.3","2.0.3","4.10.1","1.2.0.1","0.3.5","2.5.1","0.3.3","1.0.9","2.1.3","1.4.1","2.1.2","2.0.2","1.0.6","2.17","0.14","1.0.3","0.4.2","1.2.1","1.7.3","0.61.1","0.7.4","2.0","4.2.0","1.7.8","1.4.1","3.1.8","1.2.1","1.2.0","1.3.2","0.1.0","4.2.0","0.3.0","1.2.2","4.2.0","0.5.0","0.4.1","2.5.0","0.34","1.3.3","1.8-4","2.3.6"]}]}]}
</script>
<!--/html_preserve-->
</section>

<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-section" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Artículo 2 Ley Orgánica de Régimen Tributario Interno y artículo 1 del Reglamento de la Ley.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Las sucesiones indivisas para la liquidación del impuesto a la renta son consideradas como unidades económicas independientes, es decir, que se entienden y tratan como una persona natural. Las sucesiones indivisas son contribuyentes temporales, su existencia comienza con la muerte de una persona natural y termina por orden judicial o por testamento del difunto, es decir, cuando los herederos incorporan la herencia del fallecido a su propio patrimonio (Presidencia de la República del Ecuador, 2010).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>